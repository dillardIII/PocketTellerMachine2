# === FILE: main.py ===
# ðŸš€ PTM Core Launcher â€“ Starts bots, assistants, bridge, and systems

import threading
from agents.bridge_team_launcher import start_bridge_team
from sweep_handler import SweepHandler
from command_listener import CommandListener
from reflex_engine import ReflexEngine
from file_exec_engine import start_exec_engine
from master_watcher import main as start_master_watcher

print("[PTM] ðŸš€ Launching Core PTM Stack...")

# === Start Reflex AI Engine ===
reflex = ReflexEngine()
print("[ReflexEngine] ðŸ§  Initialized Reflex AI Engine")

# === Start Command Listener ===
listener = CommandListener()
listener.start()
print("[CommandListener] ðŸŽ§ Initialized and ready to receive commands.")

# === Start Sweep Handler ===
sweeper = SweepHandler()
sweeper.start()
print("[SweepHandler] ðŸ”„ Monitoring system...")

# === Start Bridge Bots ===
print("[MAIN] ðŸ”— Starting Bridge...")
start_bridge_team()

# === Start File Execution Engine ===
start_exec_engine()

# === Start Master Watcher (checks queue & executes tasks) ===
watcher_thread = threading.Thread(target=start_master_watcher, daemon=True)
watcher_thread.start()
print("[MasterWatcher] ðŸ§­ Watching build queue & ghost voice control...")

# === Idle Loop (Keeps App Running) ===
try:
    while True:
        pass
except KeyboardInterrupt:
    print("\n[MAIN] â›” Shutting down PTM...")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
from reflex_engine import ReflexEngine
from command_listener import CommandListener
from sweep_handler import SweepHandler
from agents.bridge_team_launcher import start_bridge_team
from file_exec_engine import start_exec_engine
from loop_monitor import monitor_loop_health
from ghostforge_writer import ghostforge_loop
from autonomous_trade_executor import run_autonomous_trading
from meta_dispatcher import MetaDispatcher
from skypiea_node import run_skypiea_loop
from neural_predictor import neural_predictor_loop
from high_risk_manager import run_high_risk_loop

# New Apex Empire Brain
from quantum_brain import quantum_brain_loop
from ghost_memory_matrix import ghost_matrix_loop
from hyperforge_pipeline import hyperforge_loop

threads = []

print("[PTM EMPIRE] ðŸš€ Launching ENEMY UPDATED SUPERFORGED STACK...")

# === Start Reflex Engine
reflex = ReflexEngine()
print("[ReflexEngine] ðŸ§  Initialized Reflex AI Engine")

# === Start Command Listener
listener = CommandListener()
listener.start()
threads.append(listener)
print("[CommandListener] ðŸŽ§ Listening for commands...")

# === Start Sweep Handler
sweeper = SweepHandler()
sweeper.start()
threads.append(sweeper)
print("[SweepHandler] ðŸ§¹ Monitoring system...")

# === Start Bridge Team
print("[BridgeTeam] ðŸ”— Deploying bridge bots...")
start_bridge_team()

# === Helper function
def start_thread(target, name):
    t = threading.Thread(target=target, name=name, daemon=True)
    t.start()
    threads.append(t)

# === Start all empire systems
start_thread(start_exec_engine, "FileExecEngine")
start_thread(monitor_loop_health, "LoopMonitor")
start_thread(ghostforge_loop, "GhostForgeWriter")
start_thread(run_autonomous_trading, "AutoTrader")
start_thread(run_skypiea_loop, "SkypieaNode")
start_thread(neural_predictor_loop, "NeuralPredictor")
start_thread(run_high_risk_loop, "HighRiskManager")

# === Start Empire Brain modules
start_thread(quantum_brain_loop, "QuantumBrain")
start_thread(ghost_matrix_loop, "GhostMatrix")
start_thread(hyperforge_loop, "HyperForge")

# === Meta Dispatcher
dispatcher = MetaDispatcher()
t = threading.Thread(target=dispatcher.start_task_monitor, name="MetaDispatcher", args=(30,), daemon=True)
t.start()
threads.append(t)

# === Empire heartbeat
try:
    while True:
        time.sleep(10)
        print("[PTM EMPIRE] ðŸ’“ Main heartbeat â€“ all empire systems alive, hunting enemies.")
except KeyboardInterrupt:
    print("\n[PTM EMPIRE] â›” Shutting down empire...")